name: Deploy to DigitalOcean

on:
  workflow_dispatch:
    inputs:
      environment:
        type: 'choice'
        description: 'Specify the target environment'
        required: false
        options:
            - 'dev'
            - 'stage'
            - 'prod'
        default: 'dev'
      firebird-server:
        type: 'boolean'
        description: 'firebird-server'
        required: true
        default: true
      servicebroker:
        type: 'boolean'
        description: 'servicebroker'
        required: true
        default: true
      webcms:
        type: 'boolean'
        description: 'webcms'
        required: true
        default: true
      go-api:
        type: 'boolean'
        description: 'go-api'
        required: true
        default: true
      
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
    
      - name: Deploy Docker Compose services
        run: |

            SERVICES=""

            # Check if firebird-server service should be built
            if [ "${{ github.event.inputs.firebird-server }}" == "true" ]; then
               SERVICES="$SERVICE firebird"
            fi

            # Check if servicebroker service should be built
            if [ "${{ github.event.inputs.servicebroker }}" == "true" ]; then
               SERVICES="$SERVICE servicebroker"
            fi

            # Check if webcms service should be built
            if [ "${{ github.event.inputs.webcms }}" == "true" ]; then
               SERVICES="$SERVICE webcms"
            fi

            # Check if go-api service should be built
            if [ "${{ github.event.inputs.go-api }}" == "true" ]; then
               SERVICES="$SERVICE go-api"
            fi

            # List of service should be built
            echo $SERVICES
    
            